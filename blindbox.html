<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link
      rel="stylesheet"
      type="text/css"
      href="./css/blind_box.css"
    />
    <link rel="icon" type="image/png" href="./images/icon.ico" />
    <!-- <script src="./js/spin.js"></script> -->
    <title>Lazada</title>
  </head>
  <body>
    <!-- Top strip -->
    <div class="top-strip">
      <div class="container">
        <div class="top-links">
          <a href="#">ChƒÉm s√≥c kh√°ch h√†ng</a>
          <a href="./orderdetail.html">Ki·ªÉm tra ƒë∆°n h√†ng</a>
        </div>
        <div class="top-actions">
          <a href="#">ƒêƒÉng nh·∫≠p</a>
          <a href="#">ƒêƒÉng k√Ω</a>
        </div>
      </div>
    </div>

    <!-- Header -->
    <header class="main-header">
      <div class="container">
        <!-- Logo lazada -->
        <div class="logo">
          <!-- Thay b·∫±ng logo th·∫≠t -->
          <a href="./index.html" aria-label="Trang ch·ªß Lazada">
            <img src="./images/lazada_icon.png" alt="Logo" />
          </a>
        </div>

        <!-- Search bar -->
        <div class="search-wrap">
          <div class="search-row">
            <input
              type="text"
              placeholder="T√¨m ki·∫øm tr√™n Lazada, s·∫£n ph·∫©m, th∆∞∆°ng hi·ªáu..."
              aria-label="T√¨m ki·∫øm"
              class="search-input"
            />
            <button aria-label="T√¨m ki·∫øm" class="search-btn">T√¨m ki·∫øm</button>
          </div>
        </div>

        <!-- Cart -->
        <div class="cart">
          <button class="cart-btn" aria-label="Gi·ªè h√†ng">
            <img src="./images/shopping_cart.png" alt="Gi·ªè h√†ng" />
          </button>
        </div>
      </div>

      <!-- Mini features -->
      <div>
        <div class="mini-features" aria-hidden="true">
          <span>üîñ LazMall</span>
          <span>üè∑ M√£ Gi·∫£m Gi√°</span>
          <span>üí≥ N·∫°p Th·∫ª & eVoucher</span>
          <span>üåç LazGlobal</span>
        </div>
      </div>
    </header>
    
    </div>
    <!-- ...existing code... -->
    <main class="blindbox-main">
        <h1>Ch∆°i V√≤ng Quay May</h1>
        <div class="container">
            <div class="wheel">
                <div class="number" style="--i:1;--clr:#db7093;"> <span>Gi·∫£m 20%</span></div>
                <div class="number" style="--i:2;--clr:#ff6347;"> <span>Iphone 17</span></div>
                <div class="number" style="--i:3;--clr:#ff8c00;"> <span>Free ship</span></div>
                <div class="number" style="--i:4;--clr:#ffd700;"> <span>Gi·∫£m 30%</span></div>
                <div class="number" style="--i:5;--clr:#90ee90;"> <span>M·∫•t l∆∞·ª£t</span></div>
                <div class="number" style="--i:6;--clr:#1e90ff;"> <span>Gi·∫£m 10%</span></div>
                <div class="number" style="--i:7;--clr:#9370db;"> <span>Gi·∫£m 50K</span></div>
                <div class="number" style="--i:8;--clr:#ff69b4;"> <span>M·∫•t l∆∞·ª£t</span></div>
            </div>
            <div class="spinBtn">Spin</div>
    </main>
    <!-- Popup k·∫øt qu·∫£ quay -->
    <div id="resultPopup" class="result-popup" style="display:none;">
        <div class="result-popup-content">
            <span id="resultText"></span>
            <button class="result-popup-close" onclick="closeResultPopup()">ƒê√≥ng</button>
            <div id="confettiContainer" class="confetti-container"></div>
        </div>
    </div>
<!-- ...existing code... -->
  </body>
  <script>
    /* S·ª≠a l·∫°i logic spin + t√≠nh ph·∫ßn tr√∫ng */
    let wheel = document.querySelector(".wheel");
    let spinBtn = document.querySelector(".spinBtn");
    let confettiContainer = document.getElementById("confettiContainer");

    // T·ªïng g√≥c hi·ªán t·∫°i (ghi nh·ªõ gi·ªØa c√°c l·∫ßn quay)
    let currentRotation = 0;

    // H√†m quay
    spinBtn.onclick = function () {
      // t·∫°o s·ªë ƒë·ªô quay ng·∫´u nhi√™n cho l·∫ßn n√†y (√≠t nh·∫•t 2 v√≤ng, t·ªõi nhi·ªÅu v√≤ng)
      // V√≠ d·ª•: 720 (2 v√≤ng) -> 3600 (10 v√≤ng)
      const spinAmount = 720 + Math.floor(Math.random() * 2881); // 720..3600
      const finalRotation = currentRotation + spinAmount;

      // th·ª±c hi·ªán animation
      wheel.style.transition = "transform 4.5s cubic-bezier(.25,.8,.25,1)";
      wheel.style.transform = `rotate(${finalRotation}deg)`;

      // disable n√∫t trong khi quay
      spinBtn.style.pointerEvents = "none";
      spinBtn.classList.add('spinning');

      // Sau khi animation k·∫øt th√∫c (ch·ªçn timeout kh·ªõp v·ªõi th·ªùi gian transition)
      setTimeout(() => {
        // cho ph√©p quay l·∫°i
        spinBtn.style.pointerEvents = "auto";
        spinBtn.classList.remove('spinning');

        // c·∫≠p nh·∫≠t currentRotation cho l·∫ßn quay ti·∫øp theo
        currentRotation = finalRotation;

        // hi·ªán popup k·∫øt qu·∫£, truy·ªÅn finalRotation ƒë·ªÉ t√≠nh ch√≠nh x√°c
        showResultPopup(finalRotation);
      }, 4500);

      // (KH√îNG) thay ƒë·ªïi currentRotation ·ªü ƒë√¢y tr∆∞·ªõc khi popup
    };

    /* H√†m t√≠nh segment tr√∫ng v√† hi·ªán popup.
      Truy·ªÅn v√†o finalRotation l√† g√≥c ƒë√£ d√πng ƒë·ªÉ rotate.
    */
    function showResultPopup(finalRotation) {
      const numbers = document.querySelectorAll('.number'); // c√°c √¥ segment, gi·ªØ th·ª© t·ª± DOM
      const segCount = numbers.length;
      if (segCount === 0) return;

      // Chu·∫©n ho√° g√≥c trong [0, 360)
      const normalized = ((finalRotation % 360) + 360) % 360; 
      const anglePer = 360 / segCount;

      // C√îNG TH·ª®C TH∆Ø·ªúNG D√ôNG:
      // N·∫øu v·ªã tr√≠ "m·ªëc" (pointer) ·ªü TOP (0¬∞) v√† segment 0 b·∫Øt ƒë·∫ßu t·ª´ TOP theo chi·ªÅu kim ƒë·ªìng h·ªì,
      // index = Math.floor(normalized / anglePer)
      //
      // Tuy nhi√™n trong nhi·ªÅu implement segment th·ª© t·ª± c√≥ th·ªÉ ng∆∞·ª£c ho·∫∑c kim ·ªü v·ªã tr√≠ kh√°c.
      // M·ªôt c√¥ng th·ª©c an to√†n (th∆∞·ªùng d√πng khi b√°nh d·ª±ng theo DOM t·ª´ tr√°i sang ph·∫£i v√† pointer ·ªü TOP):
      //   index = (segCount - Math.floor(normalized / anglePer)) % segCount;
      //
      // Th·ª≠ c·∫£ 2 n·∫øu k·∫øt qu·∫£ sai, ho·∫∑c ƒëi·ªÅu ch·ªânh theo v·ªã tr√≠ pointer/thu·∫≠t to√°n d·ª±ng segment c·ªßa b·∫°n.

      // M√åNH S·∫º D√ôNG ph∆∞∆°ng ph√°p ƒë·∫£o (th∆∞·ªùng kh·ªõp v·ªõi nhi·ªÅu b√°nh quay):
      let idx = (segCount - Math.floor(normalized / anglePer)) % segCount;
      if (idx < 0) idx += segCount;

      // N·∫øu k·∫øt qu·∫£ c√≥ v·∫ª ƒë·∫£o ng∆∞·ª£c v·ªõi th·ª© t·ª± DOM, th·ª≠ d√πng:
      // let idx = Math.floor(normalized / anglePer);

      let prize = numbers[idx].textContent.trim();
      document.getElementById('resultText').innerHTML = `B·∫°n ƒë√£ quay tr√∫ng: <b>${prize}</b> üéâ`;
      document.getElementById('resultPopup').style.display = 'flex';
      showConfetti();
    }

    /* Confetti (gi·ªØ nguy√™n c·ªßa b·∫°n, ch·ªâ thay m·ªôt ch√∫t ƒë·ªÉ an to√†n) */
    function showConfetti() {
      const container = document.getElementById('confettiContainer');
      container.innerHTML = "";
      for (let i = 0; i < 32; i++) {
        let conf = document.createElement("div");
        conf.className = "confetti";
        conf.style.left = (60 + Math.random() * 180) + "px";
        conf.style.bottom = "0px";
        conf.style.background = randomColor();
        container.appendChild(conf);
      }
      setTimeout(() => {
        container.innerHTML = "";
      }, 1300);
    }

    function randomColor() {
      const colors = ["#db7093","#ff6347","#ff8c00","#ffd700","#90ee90","#1e90ff","#9370db","#ff69b4"];
      return colors[Math.floor(Math.random() * colors.length)];
    }

    function closeResultPopup() {
      document.getElementById('resultPopup').style.display = 'none';
    }
    </script>

</html>
